<html>

  <head>

    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <!DOCTYPE html>
</head>  


<body>

  <script>
    window.sessionStorage

    //https://stackoverflow.com/questions/4187146/truncate-number-to-two-decimal-places-without-rounding
    
  

var var1 =1;
var var2 =1;
var var3 ;
var3 = var1 + var2;

alert("at point");

//function getparam(param_name)
//{
	//has been a search there is a parameter
	let params = new URLSearchParams(window.location.search);
	var string = (params.get("val"));
//}

//var inputs = form.getElementsByTagName("val");
alert(string);



</script>
    
      <input   id="button7"  type="button" value="checkout"/>
      <input   name = "search" type="text" id="search" name="search" placeholder= "apple1" value="apple1"/>
      <input   id="button6"  type="button" value="Search"/>

      <br>
      <div id = "firstdiv" ></div>
      <br>
      <div id ="buttons"></div>
      <br>
      <div id ="templateOneHere"> </div>
     

      
     
      
      <div id = "lastdiv"></div>
      
<script>

var array1 = [];
function insert(pid, quantLeft) {
    array1.push({
        pid: pid,
        quant: quant,
       
    });        
}








$(document).ready(function () {
      $('#button3').click(function () {


        
  //https://stackoverflow.com/questions/8951810/how-to-parse-json-data-with-jquery-javascript
  // https://stackoverflow.com/questions/5061310/jquery-returning-parsererror-for-ajax-request
    
        //example
       $.ajax({
              url: 'http://localhost:8080/getMessages',
              type: 'POST',
              dataType: 'json',
              contentType: "application/json",
              //data: { name: "John", age: 30, city: "New York" },
              data:{post_data: 'hello world'}, //JSON.stringify({ "name": name, "city": city }),
              crossDomain: true,
             
            success: function (data1) {
             // alert(data1);
              console.log(data1[2].Age);
              
              //alert("in here!!!");
              //alert(v)
              }
              });
          
         });

    });


  
	var querystring = "";

  //template button press - display searches a keyword
    //$(document).ready(function () {
      $("#button6").click(function () {

		
        var string = ""
        let keys = Object.keys(sessionStorage);

        var wasKeys = "no";


		//let storedArray = ["test"];
      for(let key of keys) {
        if(key == "session_userID")
        {
        continue;
        }
		else if(key == "searchterms")
        {
			var item = sessionStorage.getItem(key);

			item = item.slice(2);
			item = item.substr(0, item.length - 2);
			//alert("in here...");
			//alert(item);
			//var testArray = item;
			//var test = (item.join());
			alert("did i get here?");
			alert(item);

			//alert("is this it");
			//alert(item);
			//const val = item.join();
			//console.log(item.join());
			//alert("a");
			string = string + "var=" + item + "&";
			//alert("is this it");
			//alert(item.join(", "));
			continue;
		}


       var item = sessionStorage.getItem(key);
       string =  string + "id=" + key + "&quant=" + item + "&";
  
       wasKeys = "yes";
        
      }




      var val1 = document.getElementById("search").value;
      if(wasKeys == "yes"){

		
        var testArray = [val1];
		//puts testarray in searchterms
		alert("in here111");
		//testArray = (testArray.join());
		window.sessionStorage.setItem("searchterms", JSON.stringify(testArray));
		
		var storedArray = JSON.parse(sessionStorage.getItem("searchterms"));


		for (i = 0; i < storedArray.length; i++) {


		querystring += ("var=" + storedArray[i] + "&");
		querystring += string;
     	 }

	  }	
      else
      {

		
		var testArray = [val1];
		alert("in here222");
		//testArray = (testArray.join());
		//puts testarray in searchterms
		window.sessionStorage.setItem("searchterms", JSON.stringify(testArray));
		
		var storedArray = JSON.parse(sessionStorage.getItem("searchterms"));
		//storedArray.push(val1);
		for (i = 0; i < storedArray.length; i++)
		{
			querystring += ("var=" + storedArray[i] + "&");
		}
		
      }

        

	  //querystring = querystring + "id=3&quant=10&";

        alert("querystring10a");
        alert(querystring);
        
       // alert(val1);
          $.ajax({
              url: "http://localhost:8080/display",
              type: 'GET',
              dataType: 'html',
              contentType: "application/x-www-form-urlencoded",
              crossDomain: true,
              data: querystring,
              success: function (result) {
                
                
                //$('#buttons').html( result);
                var result1 = "<a href='#" + val1 + "'>" + val1 + "</a><br>";

                //alert("important check");
                //alert(result1);

                //var result2 = "<a href='#apple1'>*apple*</a>" + result;

                document.getElementById('buttons').innerHTML   += result1;

                document.getElementById('templateOneHere').innerHTML   += result;
                              
                              
             
              
                }
          });
      });
  //});



  
	  if(string == "1")
	  {
		  alert("in here");
		  document.querySelector("#button6").click();	
	  }


  

  //checkout button
  $(document).ready(function () {
      $('#button7').click(function () {
              //////////
              //calls purgehtml which calls template2.html - go
             alert("finalpage");
              window.location.href = "finalPage.html";
              
              
                });  
              });
              ////////////


//not used...
function uploadandProcessImage(){


///////////////////////////////////
//https://stackoverflow.com/questions/25493706/ajax-upload-file-to-golang-server-with-content-type-multipart
var xhr = new XMLHttpRequest();
    //boundary=Math.random().toString().substr(2);


    var input = document.querySelector('input[type=file]'),
    file = input.files[0];

    
var formdata = new FormData();
formdata.append("file", file);
xhr.open("POST", "localhost:8080/upload", true);
//xhr.setRequestHeader("content-type", "multipart/form-data; charset=utf-8; boundary=" + boundary);
xhr.send(formdata);

///////////////////////////////////

}


var gTotalOfPurchases = 0;

function changeFields(originalQuantity, productID, quantityID, amountPurchasedID, amountToPurchaseID)
			{
				

				

				//alert(quantityID);

				var amountToBePurchased  = 0;
				var  amountInPurchasedField = 0;
				var amountPurchasedSoFar = 0;
				var value1 = 0;
				var value2 = 0;
				//total of product with server
				amountInPurchasedField = document.getElementById(quantityID).value;
				//already purchased
				amountPurchasedSoFar = document.getElementById(amountPurchasedID).value;
				//alert("in the amount purchased");
				//alert(amountPurchasedSoFar);
				
				//amount held for subtraction when submit button pressed
				amountToBePurchased = document.getElementById(amountToPurchaseID).value;
				//alert(amountToBePurchased);
				
				//alert(amountToBePurchased);
				//document.getElementById(amountPurchasedID).value="";

				
				//if there is enough product go in here - take from quantity amount
				if((parseInt(amountInPurchasedField) >= parseInt(amountToBePurchased))   )//&& parseInt(amountToBePurchased) > 0  )
				{

					
					//
					value1 = document.getElementById(amountToPurchaseID).value; 
					//value2 = amountopurchase + amountpurchaseedsofar
					value2  = parseInt(value1) + parseInt(amountPurchasedSoFar);
					if(value2 < 0)
					{
						document.getElementById(amountToPurchaseID).value = 0;
						return;
					}
					//alert("values");
					//alert(value1);
					//alert(value2);
					//alert(amountPurchasedSoFar)
					
					//puts total in here
					document.getElementById(amountPurchasedID).value = value2 ;
					
					if(value1 > 0){

						//alert("a");
					document.getElementById(quantityID).value = parseInt(amountInPurchasedField) - parseInt(amountToBePurchased) ;
					}else if (value1 == 0)
					{
						//alert("b");
					}

					//negative value for amount to purchase
					//value
					else if ( (parseInt(amountPurchasedSoFar) + parseInt(value1)) > -1){
						//alert("in neg");
						//alert(amountInPurchasedField);
						//alert( amountToBePurchased);
						document.getElementById(quantityID).value = parseInt(amountInPurchasedField) - parseInt(amountToBePurchased) ;
						//
						document.getElementById(amountToPurchaseID).value = 0;
					}


					//alert(amountToBePurchased);
					
					gTotalOfPurchases =  parseInt(gTotalOfPurchases) +  parseInt(amountToBePurchased); 
					
					//alert(amountToBePurchased);
					
					if(gTotalOfPurchases > 0){
                        document.getElementById(amountToPurchaseID).value = 0;
                        //alert("here");
						//alert(amountToBePurchased);
						
						//so far, so good is still in database!
						setData(originalQuantity, productID, amountToBePurchased, 0)
                        return (1);
                    }

					///////////


				

					///////////



				}
      }


      
      function  setData(quantityOfProduct, productID, quantityTryingToSet, reduceBool)
			{
				//if(firstTime == "yes")
				//{
				//	//sessionStorage.clear();
				//	firstTime = "no";
				//}
				
				var string = "";
				
				var keyFlag = ""
				var bought, totalquantity = 0;

				//alert("before");





				let keys = Object.keys(sessionStorage);
				//console.log(keys);
				for(let key of keys) {
					//alert("key");
					//alert(key)
					//alert("prodcutid")
					//alert(productID)
				
				//total the quantity and overwrite - is already a record
				if(key == (productID.toString())){
				
					//alert("in this place");
					//alert(productID);
					//alert("setdata");
					keyFlag = "found";
					//sofar
					//alert(sessionStorage.getItem(key));
					
					//bought
					bought = sessionStorage.getItem(key);
					//alert("bought");
					//alert(bought);
					//document.getElementById(amountPurchasedID).value = bought;
					//alert(quantityOfProduct);
					//quantity of records is decreasing
					var totalquantity = 0;
					
					//if (reduceBool)
					//{
					//	//alert("1a");
					//	totalquantity =  parseInt(bought) -  parseInt(quantityTryingToSet);
					//	//alert(quantityOfProduct);
					//}
					//quantity of records is acummulating
					//else 
					{
						//alert("1b");
						//alert(quantityOfProduct);
						//alert(quantityTryingToSet);
						//alert(totalquantity);
						//alert(quantityTryingToSet);
						totalquantity = parseInt(bought) + parseInt(quantityTryingToSet);
						//console.log(document.getElementById(amountPurchasedID).value);
						//document.getElementById(amountPurchasedID).value = 579;//'//totalquantity;
						//alert("quantityOfProduct");
						//alert(quantityOfProduct);
						//alert("quantityTryingToSet");
						//alert(quantityTryingToSet);
						//alert("totalquantity");
						//alert(totalquantity);
						
					}
					
					
					//overwrites
					sessionStorage.removeItem(productID);
					//alert("set");
					//alert(productID);
					//alert(totalquantity);
					sessionStorage.setItem(productID, totalquantity);
					//alert("overwrites")
					break;
				
					}
				}
				//there is no productID record yet, make one here 
				if (keyFlag !=  "found")
				{
					//alert("new item");
					sessionStorage.setItem( parseInt(productID),  parseInt(quantityTryingToSet));
				}
				
                

			}



</script>


    </body>
    </html>