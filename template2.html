<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

      <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      
      .center {
        margin-left: auto;
        margin-right: auto;
      }
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
	</head>  

<br>

{{range .}}
{{if(eq .Condition 1)}}
<table style="width:60%" class="center">
<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Cost</center></th> 
</tr>
{{end}}



<tr>
<td> <center><p> <input id = "{{.AmountToBuyID}}" value =""   type="" name="" placeholder="" size="2">	</p></center></td>
			

<td><center> {{.ProductName}}</center>  </td>
<td><center>{{.ProductCatTitle}}</center> </td>




  <td> <center><p> <input id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="3" readonly >	</p></center></td>


  
  <td> <center><p> <input id = "{{.CostID}}" value ="{{.ProductCost}}"  type="" name="" placeholder="" size="3" readonly >	</p></center></td>



</tr>

{{if(eq .Condition2 -1)}}


</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.ProductQuantity}}')">Final Purchase</button></center>
{{end}}
{{end}}

<script>


function checkAllAvailableProducts(quantity){



alert("encode to dbase");
  //var amtInBuyBox = document.getElementById(amttobuyID).value;

  //for amountinboxid
  var var1 = "A";
  //for costid
  var var2 = "C";
  var var3 = "D" 
  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  
    let keys = Object.keys(sessionStorage);
    for(let key of keys) {
        counter++;
        //input boxes id
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
      
        //amount in box
        var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
        var quantityInBox = parseInt(document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
        //alert(AmountOfCostID);
        //alert(costInBox);
        //console.log("starts here");
        //console.log(sessionStorage.getItem(key));
        //console.log(amtInBuyBox);
        
        //amount bought before purchase
        var item = parseInt(sessionStorage.getItem(key)) + amtInBuyBox;
        string =  string + "id=" + key + "&quant=" + item + "&";
        
        
        
        //console.log("string");
        //console.log(string);
        //console.log("item");
        //console.log(item);
        //console.log("key");
        //console.log(sessionStorage.getItem(key));
        //console.log("in box");
        //console.log(amtInBuyBox);
}
//goes backwards and last entered writes over
queryString = string.substring(0, string.length-1);

alert(queryString);


              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              contentType: "application/json",
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {
              //alert(data1);
              //console.log(data1[1].ID);
              
              //total all elemetst, two per array.
              var lengthOfData = data1.length;
                //array has double because 2 variables
                //iterate for divid and amountinboxid
              //for(i = 0; i < (lengthOfData/2); i++)
              {
                //console.log(lengthOfData);
                alert("in here!!!");
                
                //console.log("available");
                //console.log((((data1[i].QuantityAvailable))));
                //console.log("quantity");
                //console.log(quantity);
                //document.getElementById(putChangeHere).innerHTML= 100 - (((data1[i].QuantityAvailable)));
                document.getElementById(AmountOfQuantityID ).value = 100 - (((data1[counter].QuantityAvailable)));
                document.getElementById(AmountOfCostID ).value = costInBox * document.getElementById(AmountOfQuantityID ).value ;
               
               
                //var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
               

              }

            
              }
              });

}


</script>

</body>
</html>