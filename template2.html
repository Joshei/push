<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

      <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      
      .center {
        margin-left: auto;
        margin-right: auto;
      }
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
	</head>  

<br>

{{range .}}
{{if(eq .Condition 1)}}
<table style="width:60%" class="center">
<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Bought</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items</center></th> 

</tr>
{{end}}



<tr>
<td> <center><p > <input  id = "{{.AmountToBuyID}}"  onclick= "changeColorToBlack('{{.AmountToBuyID}}')"    value =""   type="number" name="" placeholder="" size="8">	</p></center></td>
			

<td><center> {{.ProductName}}</center>  </td>
<td><center>{{.ProductCatTitle}}</center> </td>




  <td> <center><p> <input id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="${{.ProductCost}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "${{.TotalCost}}"   type="" name="" placeholder="" size="8" readonly >	</p></center></td>



</tr>

{{if(eq .Condition2 -1)}}
<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td> <center><p> <input id = "" value = "Tax:  .05% "   type="" name="" placeholder="" size="12" readonly >	</p></center></td>
</tr>
<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td> <center><p> <input id = "{{.GrandTotalStringID}}" value = "Grand Total: ${{.GrandTotalString}}"   type="" name="" placeholder="test" size="20" readonly >	</p></center></td>
 </tr>

</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}' , '{{.GrandTotalString}}', '{{.GrandTotalStringID}}' )">Checkout</button></center>

{{end}}
{{end}}

<script>



function changeColorToBlack(AmountToBuyID)
{
  document.getElementById(AmountToBuyID).style.color = "black";
  //document.getElementById(AmountToBuyID).value = "";
 
}


function checkAllAvailableProducts(quantity, gtotal, grandTotalID){

  
  
  var gtotal = parseFloat(gtotal);
  
  
  //alert("encode to dbase");
  //var amtInBuyBox = document.getElementById(amttobuyID).value;

  //for amountinboxid
  var var1 = "A";
  //for costid
  var var2 = "C";
  //for div - availablr
  var var3 = "D" 
  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  
    //var flag = "wasntHere"
    var flag = "isNotNegValue";
    let keys = Object.keys(sessionStorage);
    for(let key of keys) {
        counter++;
        //input boxes id
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
      
        //amount in box
        var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
        var quantityInBox = parseInt(document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
       

        
        //amount bought before purchase
        //var item = parseInt(sessionStorage.getItem(key)) + amtInBuyBox;
        //string =  string + "id=" + key + "&quant=" + item + "&";
        var item = /*parseInt(sessionStorage.getItem(key)) +*/ amtInBuyBox;

        //negative or has decimal
        if(item < 0 ) //|| (item == Math.floor(item)))
        {
          var str2 = amtInBuyBox.toString();
          document.getElementById(AmountToBuyID).style.color = "green";
          flag = "isNegValue";
        }
        if (isNaN(item ))
        {
          item = quantityInBox;
        }
        //flag = "wasHere"
        string =  string + "id=" + key + "&quant=" + item + "&";

        //alert("string");
        //alert(string);
    }
    //if(flag == "wasHere")
    //{
    //  return
    //}
    //alert("here");
    //alert(flag);
    
if (flag == "isNegValue")
{
  return;
}
//alert("here2");
//goes backwards and last entered writes over
var queryString = string.substring(0, string.length-1);

//alert("spit test");
//alert(queryString);


              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {



              //  type Product2 struct {
              //	ID                  int
	            //  QuantityAvailable   int
	            //  IsNotEnoughQuantity string
              //  }

                var newGrandTotalString = "a";
              
              //total all elemetst, two per array.
              var lengthOfData = data1.length;
              
              var lengthOfData = data1.length;
              //alert("start");
              //alert("length");
              //alert(var3);
              //alert(data1.length);
              //alert(data1[0].QuantityAvailable);
              //alert(data1[1].QuantityAvailable);
              //alert(data1[0].ID);
              //alert(data1[0].ID);
              //alert("finish");
              //console.log(data1[i].QuantityAvailable);
              //alert(data1);
                

              var TotalCost = 1.1;

              
              var GTotalWithTax = 0.0;
                for(var i = 0; i<(lengthOfData) ; i++)
                {

                  GTotalWithTax = 0;
                alert("lengthOfData");
                alert(lengthOfData);
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var GrandTotalStringID = "GT" + i;
                var what = document.getElementById(quantity).value;
             
                var str2= "";
                str1 = data1[i].IsNotEnoughQuantity;

                var num = data1[i].QuantityAvailable ;
                str2 = num.toString();
                //alert("str2");
                //alert(str2);
                //DatabaseQuantity < quant)



                //wasnt enough, so make red
                if (str1 == "yes")
                {

                  GTotalWithTax = 0.0;
                  //alert ("in not enough");
                  document.getElementById(availableID).outerHTML = str2.fontcolor("red");
                  
                  document.getElementById(boughtid).value = 0;

                  //string, however value is (example) : $1.00
                  TotalCost = document.getElementById(totalCostID).value;
                  TotalCost = TotalCost.slice(1);
                  alert(TotalCost);
                  var TotalCostFloat = parseFloat(TotalCost);

                  //alert("TotalCostFloat");
                  //alert(TotalCostFloat);

                  //alert("totalcostfloat1");
                  //alert(TotalCostFloat);

                  //alert("type1");
                  //alert(typeof(TotalCost));
                  //makes these variables cents 
                  //gtotal =  gtotal * (10 ** 2);
                    
                    //$9.23
                    //alert("totalcost1");
                    //alert(TotalCost);
                    //TotalCost =  TotalCost.slice(1);
                    //TotalCostFloat =  TotalCostFloat * (10 ** 2);
                    //alert("totalcostfloat2");
                    //alert(TotalCostFloat);
                    //923
                    //alert("totalcost2");
                    //alert(TotalCost);
                    //the five represents the tax of .05%
                    var tax =  TotalCostFloat * 5 ;
                    //4615
                    //alert("tax");
                    //alert(tax);
                    TotalCostFloat = TotalCostFloat * (10 ** 2);
                    //alert("totalcostfloat3");
                    //alert(TotalCostFloat);

                    //alert("totalcost3");
                    //alert(TotalCost);
                    //alert("GTotalWithTax");
                    //alert(GTotalWithTax);

                    //($1.05)
                    //105
                    GTotalWithTax =  GTotalWithTax +  tax + TotalCostFloat;
                    //GTotalWithTax = GTotalWithTax / (10 ** 2)

                    //alert("GTotalWithTax");
                    //alert(GTotalWithTax);

                    //alert("gtotal");
                    //alert(gtotal);
                    gtotal = gtotal * (10 ** 2);
                    gtotal = gtotal - GTotalWithTax;
                    gtotal = gtotal / (10 ** 2);

                    //alert("gtotal");
                    //alert(gtotal);

                    //96915
                   

                    //alert("tax");
                    //alert(tax);

                    //alert("totalcost1");
                    //alert(TotalCostFloat);

                    //96915
                    //alert("GTotalWithTax2");
                    //alert(GTotalWithTax);
                    //969
                    //alert("gtotal");
                    //alert(gtotal);
                    //96915
                    //alert("GTotalWithTax");
                    //alert(GTotalWithTax);

                ///////////
                //string - is the value so has dollar sign
                //var costEach = document.getElementById(costID).value;
                //alert("costeach");
                //alert(costEach);
                //costEach = costEach.slice(1);
                //costEach =  costEach * (10 ** 2);
               //whole number
                document.getElementById(boughtid).value = 0;
               // alert("bought");
               // alert(bought);
               // alert("costeach");
               // alert(costEach);
              //var total = (bought * costEach);
                //alert("total");
                //alert(total);
               //reinstate decimals
                //total = total / (10 ** 2);
               //  alert("total");
               //  alert(total);
               //  alert("costeach");
               //  alert(costEach);
               //  alert("bought");
               //  alert(bought);
               //https://learnersbucket.com/examples/javascript/learn-how-to-round-to-2-decimal-places-in-javascript/
               //var roundedTotal = Math.round(total * 100) / 100
                //total = total.toFixed(2); 
                //alert("total");
                //alert(total);
                TotalCostString = "$0.00"; 
                //alert("TotalCostString");
                //alert(TotalCostString);

                document.getElementById(totalCostID).outerHTML = (TotalCostString);
                var check = document.getElementById(buyThisManyID );    
                check.value = "";
                  ///////////
                  

                }//there wasn't enough product
                //there is plenty of product for this record...
                else
                {

                  /////////////////////////////////begin work to do
                  alert("in new section");

                

                //remove totalcost determined at purchase interface, so that amount to buy times cost will equal this
                //products total
                var initialTotalCost = document.getElementById(totalCostID).value;
                alert("typeof1");
                alert(typeof(initialTotalCost));

                initialTotalCost = initialTotalCost.slice(1);

                alert("typeof2");
                alert(typeof(initialTotalCost));
                //float
                initialTotalCost = parseFloat(initialTotalCost);
                alert("typeof2");
                alert(typeof(initialTotalCost));

                alert("initialTotalCostA");
                alert(initialTotalCost);
                  
                
                var initialTotalCost = initialTotalCost * (10 ** 2);

                //whole number
                var tax1 = initialTotalCost * 5;
                alert("tax1");
                alert(tax1);


                var initialTotalCost = initialTotalCost * (10 ** 2);

                alert("initialTotalCostB");
                alert(initialTotalCost);

                initialTotalCost = initialTotalCost + tax1;
                alert("initialTotalCostC");
                alert(initialTotalCost);
                  

                //intialTotalCost = initialTotalCost / (10 ** 4);


                //intialTotalCost = initialTotalCost * (10 ** 2);



                ///////////////////////end work to do

                //211.01
                alert("gtotal1");
                alert(gtotal);

                //gtotal = 2110100
                gtotal = gtotal * (10 ** 4);
                alert("gtotal2");
                alert(gtotal);
                //2110080
                alert("initialTotalCost");
                alert(initialTotalCost);
                gtotal = gtotal - initialTotalCost;
                intialTotalCost = initialTotalCost / (10 ** 2);
                gtotal = gtotal / (10 ** 4);
                alert("gtotal3!!!!");
                alert(gtotal);

                
                //gtotal = gtotal / (10 ** 4);

                alert("gtotal4");
                alert(gtotal);


                GTotalWithTax = 0;

                var amtAvailable = document.getElementById(availableID).value;
                amtAvailable = parseFloat(amtAvailable);
               
                var bought = document.getElementById(boughtid).value;
                bought = parseFloat(bought);
                
                var amtBuying = document.getElementById(buyThisManyID).value;
                amtBuying = parseFloat(amtBuying);

                alert(amtAvailable);
                alert(bought);
                alert(amtBuying);
               
                  //94   1    2
                var newAvailable = amtAvailable + bought - amtBuying;
                alert(newAvailable);
                document.getElementById(availableID).value = newAvailable;

                alert("newAvailable");
                alert(newAvailable);
                //example : 1.11 - string
                var costEach = document.getElementById(costID).value;
                costEach = costEach.slice(1);
                
                //alert(costEach);
                costEach = parseFloat(costEach);
                //move decimal right
                costEach =  costEach * (10 ** 2);

                alert("costEach");
                alert(costEach);
                //save new bought
                document.getElementById(boughtid).value = amtBuying; 
                
                
                var total = (amtBuying * costEach);
                total = parseFloat(total);
                var totalNoDecimals = total;

                

                var totalCopy = total;
               
                //has two deicmals - 20096
                total = total / (10 ** 2);
               
                
                //round
                total = total.toFixed(2); 
                 // alert("total");
                 // alert(total);


                TotalCostString = total.toString(); 
                //no dollar sign
                //alert("TotalCostString");
                //alert(TotalCostString);
                TotalCostString = "$" +  TotalCostString; 
                //alert("TotalCostString");
                //alert(TotalCostString);

                document.getElementById(totalCostID).value = (TotalCostString);

                //grand total with tax :
                //50000
                var tax =  totalCopy * 5 ;

                totalCopy = totalCopy * (10 ** 2);
                tax = parseFloat(tax);
                  
                alert("totalCopy");
                alert(totalCopy);
                alert("tax");
                alert(tax);

                alert("totalCopy");
                alert(totalCopy);
                //example:
                //($1.05)
                //10500
                alert("GTotalWithTax1");
                alert(GTotalWithTax);

                GTotalWithTax =  tax + totalCopy;

                alert("gtotal!!!!!");
                alert(gtotal);
                alert("GTotalWithTax1");
                alert(GTotalWithTax);

                gtotal = gtotal * (10 ** 2);
                
                gtotal = gtotal + GTotalWithTax;
                alert("gtotal");
                alert(gtotal);

                gtotal = gtotal / (10 ** 2); 
                
                //alert("gtotalcopy");
                //alert(gtotalCopy);
                var gtotalCopy = gtotal;
                //4220160
                alert("gtotalCopy1A");
                alert(gtotalCopy);

                gtotalCopy = gtotalCopy / (10 ** 2)

                alert("gtotalCopy2");
                alert(gtotalCopy);

                var stringGrandTotal = gtotalCopy.toFixed(2); 
                alert(typeof(stringGrandTotal));

                alert("stringGrandTotal");
                alert(stringGrandTotal);

               
                stringGrandTotal = "Grand Total: $" + stringGrandTotal;

                document.getElementById(grandTotalID).outerHTML = (stringGrandTotal);
                
                   //alert("totalcost1");
                   //alert(TotalCost);
                  
                   //totalCostString =  totalCostString * (10 ** 2);
                   //923
                   //alert("totalcost2");
                   //alert(TotalCost);
                   //the five represents the tax of .05%
                   //var tax =  TotalCostString  * 5 ;
                   //4615
                   //alert("tax");
                   //alert(tax);
                   //TotalCostString  = TotalCostString  * (10 ** 2);
                   //alert("totalcost3");
                   //alert(TotalCost);
                   //GTotalWithTax =  GTotalWithTax * (10 ** 2);
                   //GTotalWithTax =  GTotalWithTax +  tax + TotalCost;
                   //GTotalWithTax = GTotalWithTax / (10 ** 2);
                 /////////
                 
                }
                

                
                }//for

                
/*
                    gtotal = gtotal * (10 ** 2);
                    gtotal = gtotal / (10 ** 4);
                    alert("gtotal");
                    alert(gtotal);
                    GTotalWithTax = GTotalWithTax /(10 ** 2);
                    alert("GTotalWithTax3");
                     alert(GTotalWithTax);

                    gtotal = gtotal -  GTotalWithTax;
                    //alert("gtotal here");
                    //alert(gtotal);
                    GrandTotalFloat = gtotal;
                    //alert("gtotal5");
                    //alert(gtotal);
                    //alert("grandtotalfloat1");
                    //alert(GrandTotalFloat);
                    //alert("grandtotalfloat2");
                    //alert(GrandTotalFloat);
                    //returns string value
                    GrandTotalFloat = GrandTotalFloat.toFixed(2); 
                    //if(GrandTotalFloat < 0)
                    //   {
                    //     //GrandTotalFloat = 0;
                    //   } 
                    //alert("grandtotalfloat2");
                    //alert(GrandTotalFloat);
                    //alert("GTF3");
                    //alert(GrandTotalFloat);
                    var stringGrandTotal = GrandTotalFloat; 
                    //alert("stringGrandTotal");
                    //alert(stringGrandTotal);
                    var value = "$" + stringGrandTotal;
                    //alert("value");
                    //alert(value);
                    //works - sets this value to string value, grandtotal
                    document.getElementById(GrandTotalStringID).value = (value); 
*/

                ////////

              }//sucesss - goto spitback and return values
              });

}//end


Number.prototype.getPrecision = function() {
  var v = this.valueOf();
  if (Math.floor(v) === v) return 0;
  var str = this.toString();
  var ep = str.split("e-");
  if (ep.length > 1) {
    var np = Number(ep[0]);
    return np.getPrecision() + Number(ep[1]);
  }
  var dp = str.split(".");
  if (dp.length > 1) {
    return dp[1].length;
  }
  return 0;
}


</script>

</body>
</html>