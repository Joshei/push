<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

      <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      
      .center {
        margin-left: auto;
        margin-right: auto;
      }
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
	</head>  

<br>

{{range .}}
{{if(eq .Condition 1)}}
<table style="width:60%" class="center">
<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Bought</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items</center></th> 

</tr>
{{end}}



<tr>
<td> <center><p> <input id = "{{.AmountToBuyID}}" value =""   type="" name="" placeholder="" size="8">	</p></center></td>
			

<td><center> {{.ProductName}}</center>  </td>
<td><center>{{.ProductCatTitle}}</center> </td>




  <td> <center><p> <input id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="{{.ProductCost}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "{{.TotalCost}}"   type="" name="" placeholder="" size="8" readonly >	</p></center></td>



</tr>

{{if(eq .Condition2 -1)}}


</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}')">Final Purchase</button></center>
{{end}}
{{end}}

<script>






function checkAllAvailableProducts(quantity){



alert("encode to dbase");
  //var amtInBuyBox = document.getElementById(amttobuyID).value;

  //for amountinboxid
  var var1 = "A";
  //for costid
  var var2 = "C";
  //for div - availablr
  var var3 = "D" 
  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  
    let keys = Object.keys(sessionStorage);
    for(let key of keys) {
        counter++;
        //input boxes id
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
      
        //amount in box
        var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
        var quantityInBox = parseInt(document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
        //alert(AmountOfCostID);
        //alert(costInBox);
        //console.log("starts here");
        //console.log(sessionStorage.getItem(key));
        //console.log(amtInBuyBox);
        
        //amount bought before purchase
        var item = parseInt(sessionStorage.getItem(key)) + amtInBuyBox;
        string =  string + "id=" + key + "&quant=" + item + "&";
        
        
        
        //console.log("string");
        //console.log(string);
        //console.log("item");
        //console.log(item);
        //console.log("key");
        //console.log(sessionStorage.getItem(key));
        //console.log("in box");
        //console.log(amtInBuyBox);
}
//goes backwards and last entered writes over
queryString = string.substring(0, string.length-1);

alert("spit test");
alert(queryString);


              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {
              //alert(data1);
              //console.log(data1[1].ID);
              
              //total all elemetst, two per array.
              var lengthOfData = data1.length;
                //array has double because 2 variables
                //iterate for divid and amountinboxid
              //for(i = 0; i < (lengthOfData/2); i++)
              
                //console.log(lengthOfData);
                //alert("in here!!!");
                
              var lengthOfData = data1.length;
              //alert("start");
              alert("length");
              alert(var3);
              //alert(data1.length);
              alert(data1[0].QuantityAvailable);
              //alert(data1[1].QuantityAvailable);
              alert(data1[0].ID);
              //alert(data1[0].ID);
              alert("finish");
              //console.log(data1[i].QuantityAvailable);
              alert(data1);
                
                for(var i = 0; i<lengthOfData ; i++)
                {
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var what = document.getElementById(quantity).value;
               console.log(what);
                
                document.getElementById(availableID).outerHTML = "<p>" + data1[0].QuantityAvailable + "</p>";
                var costEach = document.getElementById(costID).value;

                var bought = document.getElementById(boughtid).value;
                document.getElementById(totalCostID).outerHTML = "<p>" + (bought * costEach) + "</p>";
                //var buyThisMany = document.getElementById(buyThisManyID).value;
                //var bought = document.getElementById(boughtID).value;
                //bought = bought + buyThisMany;
                //document.getElementById(boughtid).outerHTML = bought;

                document.getElementById(buyThisManyID ).outerHTML = "";

                
                }
                //document.getElementById(AmountOfQuantityID ).value = 100 - (((data1[counter].QuantityAvailable)));
                //document.getElementById(AmountOfCostID ).value = costInBox * document.getElementById(AmountOfQuantityID ).value ;
               
               
                //var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
               

              

            
              }
              });

}


</script>

</body>
</html>