<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

      <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      
      .center {
        margin-left: auto;
        margin-right: auto;
      }
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
	</head>  

<br>

{{range .}}
{{if(eq .Condition 1)}}
<table style="width:60%" class="center">
<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Bought</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items</center></th> 

</tr>
{{end}}



<tr>
<td> <center><p > <input  onclick= "changeColorToBlack('{{.AmountToBuyID}}')"   id = "{{.AmountToBuyID}}" value =""   type="number" name="" placeholder="" size="8">	</p></center></td>
			

<td><center> {{.ProductName}}</center>  </td>
<td><center>{{.ProductCatTitle}}</center> </td>




  <td> <center><p> <input id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="${{.ProductCost}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "${{.TotalCost}}"   type="" name="" placeholder="" size="8" readonly >	</p></center></td>



</tr>

{{if(eq .Condition2 -1)}}
<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td> <center><p> <input id = "" value = "Tax:  .05% "   type="" name="" placeholder="" size="12" readonly >	</p></center></td>
</tr>
<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td> <center><p> <input id = "{{.GrandTotalStringID}}" value = "Grand Total: ${{.GrandTotalString}}"   type="" name="" placeholder="test" size="20" readonly >	</p></center></td>
 </tr>

</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}' , '{{.GrandTotalString}}' )">Checkout</button></center>
{{end}}
{{end}}

<script>



function changeColorToBlack(AmountToBuyID)
{
  document.getElementById(AmountToBuyID).style.color = "black";
  //document.getElementById(AmountToBuyID).value = "";
  //alert("clicked!");
}


function checkAllAvailableProducts(quantity, gtotal){
  //alert("encode to dbase");
  //var amtInBuyBox = document.getElementById(amttobuyID).value;

  //for amountinboxid
  var var1 = "A";
  //for costid
  var var2 = "C";
  //for div - availablr
  var var3 = "D" 
  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  
    //var flag = "wasntHere"
    var flag = "isNotNegValue";
    let keys = Object.keys(sessionStorage);
    for(let key of keys) {
        counter++;
        //input boxes id
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
      
        //amount in box
        var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
        var quantityInBox = parseInt(document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
       

        
        //amount bought before purchase
        //var item = parseInt(sessionStorage.getItem(key)) + amtInBuyBox;
        //string =  string + "id=" + key + "&quant=" + item + "&";
        var item = /*parseInt(sessionStorage.getItem(key)) +*/ amtInBuyBox;

        //negative or has decimal
        if(item < 0 ) //|| (item == Math.floor(item)))
        {
          var str2 = amtInBuyBox.toString();
          document.getElementById(AmountToBuyID).style.color = "red";
          flag = "isNegValue";
        }
        if (isNaN(item ))
        {
          item = quantityInBox;
        }
        //flag = "wasHere"
        string =  string + "id=" + key + "&quant=" + item + "&";

        //alert("string");
        //alert(string);
    }
    //if(flag == "wasHere")
    //{
    //  return
    //}
    //alert("here");
    //alert(flag);
    
if (flag == "isNegValue")
{
  return;
}
//alert("here2");
//goes backwards and last entered writes over
var queryString = string.substring(0, string.length-1);

//alert("spit test");
//alert(queryString);


              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {

                var newGrandTotalString = "a";
              //alert(data1);
              //console.log(data1[1].ID);
              
              //total all elemetst, two per array.
              var lengthOfData = data1.length;
                //array has double because 2 variables
                //iterate for divid and amountinboxid
              //for(i = 0; i < (lengthOfData/2); i++)
              
                //console.log(lengthOfData);
                //alert("in here!!!");
                
              var lengthOfData = data1.length;
              //alert("start");
              //alert("length");
              //alert(var3);
              //alert(data1.length);
              //alert(data1[0].QuantityAvailable);
              //alert(data1[1].QuantityAvailable);
              //alert(data1[0].ID);
              //alert(data1[0].ID);
              //alert("finish");
              //console.log(data1[i].QuantityAvailable);
              //alert(data1);
                

              var TotalCost = 1.1;

                for(var i = 0; i<lengthOfData ; i++)
                {
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var GrandTotalStringID = "GT" + i;
                var what = document.getElementById(quantity).value;
              // console.log(what);


                var str2= ""
                str1 = data1[i].IsNotEnoughQuantity;

                var num = data1[i].QuantityAvailable ;
                str2 = num.toString();
                
                //DatabaseQuantity < quant)
                //wasnt enough, so make red
                

                //transactio at try again state
                if (str1 == "yes")
                {
                  //alert("trying this...");
                  //alert(str2);
                  document.getElementById(availableID).outerHTML = str2.fontcolor("red");
                  
                  //sets amount to but to zero
                  document.getElementById(buyThisManyID ).value = 0;
                  //sets amount bought to zero
                  document.getElementById(boughtid).value = 0;

                  TotalCost = document.getElementById(totalCostID).value;
                 
                 //cost of all the products in this "record" it is a string
                 //var TotalCost = document.getElementById(totalCostID).value;
                 //remove $
                 //TotalCost = TotalCost.slice(1);

                 //document.getElementById(totalCostID).outerHTML = "$0.00";

                 
                    //tried seperating left and right of decimals
                    //counting length of string
                    //tried multiplying by .05 to know leftmost amount of places

                   
                    //var numDecimals2 = Number(recordTotal_String).getPrecision(); 
                    
                    //makes these variables cents 
                    gtotal =  gtotal * (10 ** 2);
                    //alert("gtotal1");
                    //alert(gtotal);
                    
                    //$9.23
                    alert("totalcost1");
                    alert(TotalCost);
                    TotalCost =  TotalCost.slice(1);
                    TotalCost =  TotalCost * (10 ** 2);
                    //923
                    alert("totalcost2");
                    alert(TotalCost);
                    //the five represents the tax of .05%
                    var tax =  TotalCost * 5 ;
                    //4615
                    alert("tax");
                    alert(tax);
                    //how can I set this exponent when TotalCost is larger
                    //ie, not hardcoded - this makes this value one digit more than tax
                    //because initally, tax is one digit more than TotalCost.
                    //initial tax = 100480    initial TotalCost = 20096
                    
                    TotalCost = TotalCost * (10 ** 2);
                    //
                    //alert("tax2");
                    //alert(tax);
                    //92300
                    alert("totalcost3");
                    alert(TotalCost);
                    var GTotalWithTax = tax + TotalCost;
                    //96915
                    alert("GTotalWithTax");
                    alert(GTotalWithTax);
                    //how can I set this correctly when TotalCost is larger,
                    //this resets the decimal points to money (dollars and cents)
                    
                   
                   
                   
                   
                   
                   
                    //moves ddecimal left
                    ///////GTotalWithTax = GTotalWithTax / (10 ** 2);
                    //96915
                    alert("GTotalWithTax2");
                    alert(GTotalWithTax);

                    //969
                    alert("gtotal");
                    alert(gtotal);
                    //96915
                    alert("GTotalWithTax");
                    alert(GTotalWithTax);



                    gtotal = gtotal * (10 ** 2);
                    
                    gtotal = gtotal / (10 ** 4);

                    GTotalWithTax = GTotalWithTax /(10 ** 4);

                    gtotal = gtotal -  GTotalWithTax;

                    //gtotal = gtotal / (10 ** 5);

                   //!!!!!!!!!!!!!!
                    alert("gtotal");
                    alert(gtotal);

                    GrandTotalFloat = gtotal;
                    
                   
                    //-15
                    alert("gtotal5");
                    alert(gtotal);

                    //alert("end");


                    //1296225
                    alert("grandtotalfloat1");
                    alert(GrandTotalFloat);
                
                    //added for 12345
                   //GrandTotalFloat = GrandTotalFloat / (10 ** 4);
                   
                   alert("grandtotalfloat2");
                    alert(GrandTotalFloat);
                
                 

                 ////////////////////////////////

                 //-------------
                 //The gtotal is the grandTotal of all the records
                 //add whole numbers
                 //var GrandTotalFloatInt = (gtotal) - (TotalCost);
                 //divide the answer by the largest amount of decimals
                 //var GrandTotalFloat = GrandTotalFloatInt /  biggestNumOfDecimals ;

                
                 //????????????
                 //check this is it a string?
                 GrandTotalFloat = GrandTotalFloat.toFixed(2); 
                 if(GrandTotalFloat < 0)
                    {
                      //GrandTotalFloat = 0;
                    } 
                 alert("grandtotalfloat2");
                 alert(GrandTotalFloat);
                

                 //alert("GTF3");
                 //alert(GrandTotalFloat);
                 var stringGrandTotal = GrandTotalFloat.toString(); 
                 alert("stringGrandTotal");
                 alert(stringGrandTotal);
                 
                 var value = "$" + stringGrandTotal;
                 alert("value");
                 alert(value);
                 
                 //works
                 document.getElementById(GrandTotalStringID).value = (value); 
                
                  //continue;
                }
                
                else
                {
                  
                  //document.getElementById(availableID).outerHTML = str2;
                }
                

                //doesnt change - works
                var costEach = document.getElementById(costID).value;
                document.getElementById(costID).outerHTML = costEach
               //remove dollar sign
                costEach = costEach.slice(1);
                 //move decimal right
                costEach =  costEach * (10 ** 2);

                //whole number
                var bought = document.getElementById(boughtid).value;
               // alert("bought");
               // alert(bought);

               // alert("costeach");
               // alert(costEach);

                var total = (bought * costEach);
               // alert("total");
               // alert(total);
                //reinstate decimals
                total = total / (10 ** 2)

              //  alert("total");
              //  alert(total);



              //  alert("costeach");
              //  alert(costEach);
               // 
              //  alert("bought");
              //  alert(bought);
               



               //hopefully rounding digits (more than one) is same with golang 
               //rounded to two digits
               //https://learnersbucket.com/examples/javascript/learn-how-to-round-to-2-decimal-places-in-javascript/

                //var roundedTotal = Math.round(total * 100) / 100
                total = total.toFixed(2); 
                TotalCostString = "$" +  total.toString(); 
                
                document.getElementById(totalCostID).outerHTML = (TotalCostString);
                
                document.getElementById(buyThisManyID ).outerHTML = 0;

                
                }
                
              }//for
              });

}


Number.prototype.getPrecision = function() {
  var v = this.valueOf();
  if (Math.floor(v) === v) return 0;
  var str = this.toString();
  var ep = str.split("e-");
  if (ep.length > 1) {
    var np = Number(ep[0]);
    return np.getPrecision() + Number(ep[1]);
  }
  var dp = str.split(".");
  if (dp.length > 1) {
    return dp[1].length;
  }
  return 0;
}


</script>

</body>
</html>