<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

      <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      
      .center {
        margin-left: auto;
        margin-right: auto;
      }
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
	</head>  

<br>

{{range .}}
{{if(eq .Condition 1)}}
<table style="width:60%" class="center">
<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Bought</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items</center></th> 

</tr>
{{end}}



<tr>
<td> <center><p> <input id = "{{.AmountToBuyID}}" value =""   type="" name="" placeholder="" size="8">	</p></center></td>
			

<td><center> {{.ProductName}}</center>  </td>
<td><center>{{.ProductCatTitle}}</center> </td>




  <td> <center><p> <input id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="${{.ProductCost}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "${{.TotalCost}}"   type="" name="" placeholder="" size="8" readonly >	</p></center></td>



</tr>

{{if(eq .Condition2 -1)}}


</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}')">Final Purchase</button></center>
{{end}}
{{end}}

<script>






function checkAllAvailableProducts(quantity){



alert("encode to dbase");
  //var amtInBuyBox = document.getElementById(amttobuyID).value;

  //for amountinboxid
  var var1 = "A";
  //for costid
  var var2 = "C";
  //for div - availablr
  var var3 = "D" 
  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  
    let keys = Object.keys(sessionStorage);
    for(let key of keys) {
        counter++;
        //input boxes id
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
      
        //amount in box
        var amtInBuyBox = parseInt(document.getElementById(AmountToBuyID).value);
        var quantityInBox = parseInt(document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
       

        
        //amount bought before purchase
        //var item = parseInt(sessionStorage.getItem(key)) + amtInBuyBox;
        //string =  string + "id=" + key + "&quant=" + item + "&";
        var item = /*parseInt(sessionStorage.getItem(key)) +*/ amtInBuyBox;
        string =  string + "id=" + key + "&quant=" + item + "&";

        

}

function toFixedWithoutRounding(num, fractionDigits) {
  if ((num > 0 && num < 0.000001) || (num < 0 && num > -0.000001)) {
    // HACK: below this js starts to turn numbers into exponential form like 1e-7.
    // This gives wrong results so we are just changing the original number to 0 here
    // as we don't need such small numbers anyway.
    num = 0;
  }
  const re = new RegExp('^-?\\d+(?:\.\\d{0,' + (fractionDigits || -1) + '})?');
  return Number(num.toString().match(re)[0]).toFixed(fractionDigits);
}


//goes backwards and last entered writes over
queryString = string.substring(0, string.length-1);

alert("spit test");
alert(queryString);


              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {
              //alert(data1);
              //console.log(data1[1].ID);
              
              //total all elemetst, two per array.
              var lengthOfData = data1.length;
                //array has double because 2 variables
                //iterate for divid and amountinboxid
              //for(i = 0; i < (lengthOfData/2); i++)
              
                //console.log(lengthOfData);
                //alert("in here!!!");
                
              var lengthOfData = data1.length;
              //alert("start");
              alert("length");
              alert(var3);
              //alert(data1.length);
              alert(data1[0].QuantityAvailable);
              //alert(data1[1].QuantityAvailable);
              alert(data1[0].ID);
              //alert(data1[0].ID);
              alert("finish");
              //console.log(data1[i].QuantityAvailable);
              alert(data1);
                
                for(var i = 0; i<lengthOfData ; i++)
                {
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var what = document.getElementById(quantity).value;
              // console.log(what);


                var str2= ""
                str1 = data1[i].IsNotEnoughQuantity;

                var num = data1[i].QuantityAvailable ;
                str2 = num.toString();
                
                //was enough, red text
                //DatabaseQuantity < quant)
                if (str1 == "yes")
                {
                  alert("str2")
                  alert(str2);
                  document.getElementById(availableID).outerHTML = str2.fontcolor("red");
                }
                //wasnt enough, so make red
                else
                {
                  
                  document.getElementById(availableID).outerHTML = str2;
                }
                

                //doesnt change
                var costEach = document.getElementById(costID).value;
                
                document.getElementById(costID).outerHTML = costEach

                var bought = document.getElementById(boughtid).value;

                
                var total = (bought * costEach);
               //hopefully rounding digits (more than one) is same with golang 
               //rounded to two digits
               //https://learnersbucket.com/examples/javascript/learn-how-to-round-to-2-decimal-places-in-javascript/
                var roundedTotal = Math.round(total * 100) / 100

                document.getElementById(totalCostID).outerHTML = (roundedTotal);
                
                document.getElementById(buyThisManyID ).outerHTML = "";

                
                }
                
              }
              });

}


</script>

</body>
</html>