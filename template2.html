<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

  </head> 


  <script>
    window.sessionStorage
    </script>

      <style>
      table, th, td {
        border: 1px solid black;
       
      }

      
      
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
 

<br>
<div id = "linksHere"></div>
<br>

<div id = "buttonHere"></div>
<div id = "removeMe">
{{range .}}
{{if(eq .Condition 1)}}


<table style="width:60%; border:1px solid black;margin-left:auto;margin-right:auto;">

<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product ID</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Buying</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items</center></th> 

</tr>

{{end}}




 
<tr id = "{{.RemoveRecordDivID}}">

<td  > <center><p > <input  class = "V0"  id = "{{.AmountToBuyID}}"  onclick= "changeColorToBlack('{{.AmountToBuyID}}')"    value =""   type="number" name="" placeholder="" size="8">	</p></center></td>
			
<!-- <td><center>{{.Condition}}  {{.RemoveRecordDivID}}</center> </td>-->

<td> <center><p> <input id = "{{.ProductIDID}}" value ="{{.ProductID}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

<td> <center><p> <input id = "" value ="{{.ProductName}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

<td> <center><p> <input id = "" value ="{{.ProductCatTitle}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>


  <td class = "" > <center><p> <input   id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="${{.ProductCost}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "${{.TotalCost}}"   type="" name="" placeholder="" size="8" readonly >	</p></center></td>


</tr>

<tr id="row2" style="display: none;">
  <td colspan="2">Secret row, spooky</td>
</tr>





{{if(eq .Condition2 -1)}}
<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td> <center><p> <input id = "" value = "Tax:  .05% "   type="" name="" placeholder="" size="12" readonly >	</p></center></td>
</tr>
<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td> <center><p> <input id = "{{.GrandTotalStringID}}" value = "Grand Total: ${{.GrandTotalString}}"   type="" name="" placeholder="test" size="20" readonly >	</p></center></td>
 </tr>

</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}' , '{{.GrandTotalString}}', '{{.GrandTotalStringID}}' )">Checkout</button></center>


    
    
{{end}}
{{end}}

</div><!--removeMe-->


<script >





  
  



//function changeColorToBlack(AmountToBuyID)
//{
//  document.getElementById(AmountToBuyID).style.color = "black";
//  //document.getElementById(AmountToBuyID).value = "";
// 
//}

//entered data and pressed checkout in template2 
//before hide, amount of numberofrecords is decremented 
function checkAllAvailableProducts(quantity, gtotal, grandTotalID){

  var gtotal = parseFloat(gtotal);
  

  var val1 = "";
  
  var var1 = "A";
  
  var var2 = "C";
 
  var var3 = "D"; 

  var var4 = "B";

  var var5 = "V";

  var var6 = "P";

  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  var bought = 0;
  
    
    var flag = "isNotNegValue";
    let keys = Object.keys(sessionStorage);
    
    var amtOfHiddenProducts = 0;

    //each iteration is one purchase
    for(let key of keys) {
        counter++;
        if(key =="session_userID")
        {
          counter--;
         
          continue;
        }
        
        if(key =="keywords")
        {
          counter--;
          
          continue;
        }
        if(key =="numberOfRecords")
        {
          counter--;
         
          continue;
        }
        if(key =="alreadyZero")
        {
          counter--;
         
          continue;
        }

        
        //input boxes id
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
        BoughtID = var4 + counter;
        oneDivID = var5 + counter;
        ProductIDID = var6 + counter;
      
        var bought = (document.getElementById(BoughtID).value);
        var amtInBuyBox =(document.getElementById(AmountToBuyID).value);
        var quantityInBox = (document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
        var Product = (document.getElementById(ProductIDID).value); 
       
       
       
        
        var item = /*parseInt(sessionStorage.getItem(key)) +*/ amtInBuyBox;

        if (item == "")
        { 
          
          item = bought;
        
        }
        //check if is decimal
        if(item % 1 != 0)
        {
          
          var str2 = amtInBuyBox.toString();
          
          flag = "isNegValue";
        }

        if(item == 0)
        {

                  
                  hideRow(oneDivID);
                  amtOfHiddenProducts++;
                 
                  
                  sessionStorage.removeItem((Product), 0);
                  
                  
          continue;
          
        }
        
        else if(item < 0 ) //|| (item == Math.floor(item)))
        {
          
          var str2 = amtInBuyBox.toString();
         
          flag = "isNegValue";
        }
        else if (isNaN(item ))
        {
          
          var str2 = amtInBuyBox.toString();
         
          flag = "isNegValue";
        }

        
        if (flag == "isNegValue")
        {
          return;
        }


        
        
        //quant is amount trying to buy
        string =  string + "id=" + key + "&quant=" + item + "&";
        




        
    }

    
    
    if (amtOfHiddenProducts == (counter + 1))
    {
      

      window.location.href = "index.html";
    
      }
      
    string = string + "userid=" + sessionStorage.getItem("session_userID");

var queryString = string.substring(0, string.length-1);


              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {

                var flag = "is enough";

                
                if(data1.length == null){

                  for(let key of keys) {
       
                    alert("keys here...");
                    alert(key);
                  if(key =="session_userID")
                  {
                    continue;
                  }
                  else
                  {
                    
                      

                  }
                }

                

                window.location.href = "index.html";
            
                }

                      
                        

                for (var i = 0; i< data1.length ;i++)
                {

                  
                  
                if(data1[i].IsEnoughQuantity == false)
                {
                  alert("not enough!!!!");
                flag = "not enough";
                break;
                }
                }

                //at least one product cant be purchased
                if (flag == "not enough")
                {
                  
                  alert("isn't enough");
                }
              
                //all products can be purchasee
                else 
                {
                  alert("is enough");
                  window.location.href = "donePurchase.html";
                }

                console.log(data1);

                var newGrandTotalString = "a";
              
             
              var lengthOfData = data1.length;
              

              var TotalCost = "string";
                  
              var GTotalWithTax = 0.0;
                gFlagIsEnoughProduct = "yes";
                
               

                var gRedTextAmount = 0;
                for(var i = 0; i<(lengthOfData) ; i++)
                {

                 
                  GTotalWithTax = 0;
                
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var GrandTotalStringID = "GT" + i;
                var oneDivID1 =  "V" + i;
                
                var what = document.getElementById(quantity).value;

                var amounttobuy = document.getElementById(buyThisManyID).value;

                
               
                /////////

                bought1 = document.getElementById(boughtid).value;
                bought1 = parseFloat(bought1);
                

                amtBuying1 = document.getElementById(buyThisManyID).value;
                amtBuying1 = parseFloat(amtBuying1);





                if(bought1 == 0 && (amtBuying1 == "" || (isNaN(amtBuying1)) ))
                {
                  
                  hideRow(oneDivID1);
                  amtOfHiddenProducts++;
                  document.getElementById(buyThisManyID).value = 0;

                  

                  
                  

                  continue;
                }



                /////////
             
                var str1 = false;
                str1 = data1[i].IsEnoughQuantity;

                alert("shazam");
                alert(str1);
                var num = data1[i].QuantityAvailable;
                str2 = num.toString();
                
                //wasnt enough, so make red
                if (str1 == false)
                {

                  gFlagIsEnoughProduct = "no";

                  GTotalWithTax = 0.0;
                  
                  document.getElementById(availableID).style.color = 'red';
                  gRedTextAmount = gRedTextAmount + 1;
                  
                  
                  document.getElementById(boughtid).value = 0;

                  //string, however value is (example) : $1.00
                  TotalCost = document.getElementById(totalCostID).value ;
                  
                  TotalCost1 = TotalCost.slice(1);
                  
                  var TotalCostFloat = parseFloat(TotalCost1);

                  
                    var tax =  TotalCostFloat * 5 ;
                    
                    TotalCostFloat = TotalCostFloat * (10 ** 2);
                    
                    GTotalWithTax =  GTotalWithTax +  tax + TotalCostFloat;

                    gtotal = gtotal * (10 ** 2);
                    gtotal = gtotal - GTotalWithTax;
                    gtotal = gtotal / (10 ** 2);

                document.getElementById(boughtid).value = 0;
               
                TotalCostString = "$0.00"; 

                document.getElementById(totalCostID).value = (TotalCostString);
                var check = document.getElementById(buyThisManyID );    
                check.value = "";
                
                alert("total");
                alert(gRedTextAmount);
                alert(lengthOfData);
                if (gRedTextAmount == lengthOfData)
                {
                  stringGrandTotal = "Grand Total: $" + "0.00";
                }

                document.getElementById(grandTotalID).value = stringGrandTotal;

                }
                else
                {


                //remove totalcost determined at purchase interface, so that amount to buy times cost will equal this
                //products total
                var initialTotalCost = document.getElementById(totalCostID).value;
                
                initialTotalCost = initialTotalCost.slice(1);

                initialTotalCost = parseFloat(initialTotalCost);
                
                var initialTotalCost = initialTotalCost * (10 ** 2);

                //whole number
                var tax1 = initialTotalCost * 5;
                

                var initialTotalCost = initialTotalCost * (10 ** 2);

                
                initialTotalCost = initialTotalCost + tax1;
                
                gtotal = gtotal * (10 ** 4);
                
                gtotal = gtotal - initialTotalCost;
                intialTotalCost = initialTotalCost / (10 ** 2);
                gtotal = gtotal / (10 ** 4);
                
                GTotalWithTax = 0;

                var amtAvailable = document.getElementById(availableID).value;
                amtAvailable = parseFloat(amtAvailable);
               
                var bought = document.getElementById(boughtid).value;
                bought = parseFloat(bought);
                
                var amtBuying = document.getElementById(buyThisManyID).value;
                amtBuying = parseFloat(amtBuying);

                if(amtBuying == "" || (isNaN(amtBuying)) )
                {
                  
                  amtBuying = bought;
                }
               
                  //94   1    2
                var newAvailable = amtAvailable + bought - amtBuying;
               
                document.getElementById(availableID).value = newAvailable;

                //example : 1.11 - string
                var costEach = document.getElementById(costID).value;
                costEach = costEach.slice(1);
                
                
                costEach = parseFloat(costEach);
                //move decimal right
                costEach =  costEach * (10 ** 2);

                
                //save new bought
                document.getElementById(boughtid).value = amtBuying; 
                
                
                var total = (amtBuying * costEach);
                total = parseFloat(total);
                var totalNoDecimals = total;

                

                var totalCopy = total;
               
                //has two deicmals - 20096
                total = total / (10 ** 2);
               
                
                //round
                total = total.toFixed(2); 
                 
                TotalCostString = total.toString(); 
                
                TotalCostString = "$" +  TotalCostString; 
                

                document.getElementById(totalCostID).value = (TotalCostString);

                //grand total with tax :
                //50000
                var tax =  totalCopy * 5 ;

                totalCopy = totalCopy * (10 ** 2);
                tax = parseFloat(tax);
                 
                GTotalWithTax =  tax + totalCopy;

                gtotal = gtotal * (10 ** 2);
                
                gtotal = gtotal + GTotalWithTax;
               
                gtotal = gtotal / (10 ** 2); 
                
                var gtotalCopy = gtotal;
                

                gtotalCopy = gtotalCopy / (10 ** 2);

             
                var stringGrandTotal = gtotalCopy.toFixed(2); 
                alert(typeof(stringGrandTotal));

                stringGrandTotal = "Grand Total: $" + stringGrandTotal;
                
                if (gRedTextAmount == lengthOfData - 1)
                {
                  stringGrandTotal = "Grand Total: $" + "0.00";
                }

                document.getElementById(grandTotalID).value = stringGrandTotal;
                
                   
                 
                }//not enough product
                

                
                }//for

                
                


                ////////

              }//sucesss - goto spitback and return values
              });

}//end

/*
Number.prototype.getPrecision = function() {
  var v = this.valueOf();
  if (Math.floor(v) === v) return 0;
  var str = this.toString();
  var ep = str.split("e-");
  if (ep.length > 1) {
    var np = Number(ep[0]);
    return np.getPrecision() + Number(ep[1]);
  }
  var dp = str.split(".");
  if (dp.length > 1) {
    return dp[1].length;
  }
  return 0;
}

function hideRow(rowId)
{
    document.getElementById(rowId).style.display = "none";
}
*/

</script>

</body>
</html>