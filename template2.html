<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

      <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      
      .center {
        margin-left: auto;
        margin-right: auto;
      }
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
	</head>  

<br>
<table style="width:60%" class="center">
<tr>

<th><center>Amount to Buy</center></th>

<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Cost</center></th> 
</tr>



{{range .}}
<tr>
<td> <center><p> <input id = "" value =""   type="" name="" placeholder="" size="2">	</p></center></td>
			

<td><center> {{.ProductName}}</center>  </td>
<td><center>{{.ProductCatTitle}}</center> </td>

<td><center><div id = "{{.DivID}}"> {{.ProductQuantity}}</center> </td><div>
<div id =""><td><center>{{.ProductCost}}</center> </td></div>
</tr>
{{end}}

</table>
<br><br>
<center><button onclick="encodeToDatabase( )">Final Purchase</button></center>



<script>


function encodeToDatabase(){


    var string = ""

    let keys = Object.keys(sessionStorage);
    for(let key of keys) {
 
        var item = sessionStorage.getItem(key);
  string =  string + "id=" + key + "&quant=" + item + "&";
  
  
}
//goes backwards and last entered writes over
queryString = string.substring(0, string.length-1);
alert(queryString);

/*
                    $.ajax({
                    type:"POST",
                    url:url,
                    data:queryString,
                    async:false,
                    success: function (data1) {
                    alert("made it here!");
                    //alert(data1);
                    alert(data1[2].Quant);
                    console.log(data1[2].Quant);

*/



              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'POST',
              dataType: 'json',
              contentType: "application/json",
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {
              //alert(data1);
              //console.log(data1[1].ID);
              
              //total all elemetst, two per array.
              var lengthOfData = data1.length;

              for(i = 0; i < lengthOfData; i++)
              {
                
                alert("in here!!!");
                
                putChangeHere = "D" + data[i].ID
                //changes display
                document.getElementById(putChangeHere).value =  data1[i].QuantityAvailable;

              }

            
              }
              });

}


</script>

</body>
</html>